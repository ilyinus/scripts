cat rphost*/*.log | sed -r 's/\xef\xbb\xbf//g;/^p_[0-9]+:/d;/^$/d;s/#tt[0-9]+/#tt/g;s/^[0-9]+:[0-9]+\.[0-9]+-[0-9]+,Context,.*Context=/,Context=/;s/,Rows.*=-?[0-9]+//' | gawk -vORS='<LineBreak>' '{if (match($0, "^[0-9]+:[0-9]+\\.[0-9]+-")) print "\n"$0; else print $0;}' | sed -r '/^$/d' | egrep ',DBMSSQL,' | sed -r 's/^[0-9]+:[0-9]+\.[0-9]+-//;s/,DBMSSQL,.*Sql=/Sql=/' | tr \" \' | gawk -F 'Sql=' '{Sum[$2]+=$1; Exec[$2]+=1; if (Max[$2] < $1) {Max[$2] = $1}; if (Min[$2] == 0 || Min[$2] > $1) {Min[$2] = $1}}END{for (i in Sum) {print Sum[i]/1000000 " суммарное время (сек); " Exec[i] " количество; " Sum[i]/1000000/Exec[i] " среднее время (сек); " Max[i]/1000000 " максимальное время (сек); " Min[i]/1000000 " минимальное время (сек)<LineBreak>-----------------------------------------------------------------------------------------------------------------------------------------------<LineBreak>" i "<LineBreak><LineBreak>-----------------------------------------------------------------------------------------------------------------------------------------------"}}' | sort -rnb -t';' -k 1 | head | sed -r 's/<LineBreak>/\n/g' > DBMSSQL.txt